/*!
 * 
 *  Via Profit services / legal-entity
 * 
 *  Repository https://gitlab.com/via-profit-services/legal-entity
 *  Contact https://via-profit.ru
 *       
 */
module.exports=function(e){var n={};function i(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=n,i.d=function(e,n,t){i.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,n){if(1&n&&(e=i(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)i.d(t,a,function(n){return e[n]}.bind(null,a));return t},i.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(n,"a",n),n},i.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},i.p="",i(i.s=3)}([function(e,n){e.exports=require("@via-profit-services/core")},function(e,n,i){"use strict";var t=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(a,d){function l(e){try{o(t.next(e))}catch(e){d(e)}}function r(e){try{o(t.throw(e))}catch(e){d(e)}}function o(e){var n;e.done?a(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,r)}o((t=t.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const d=i(0),l=a(i(10));class r{constructor(e){this.props=e}getLegalEntities(e){const{context:n}=this.props,{knex:i}=n,{limit:t,offset:a,orderBy:l,where:r}=e;return i.select(["joined.totalCount","legalEntities.*"]).join(i("legalEntities").select(["id",i.raw('count(*) over() as "totalCount"')]).limit(t).offset(a).where(e=>d.convertWhereToKnex(e,r)).orderBy(d.convertOrderByToKnex(l)).as("joined"),"joined.id","legalEntities.id").orderBy(d.convertOrderByToKnex(l)).from("legalEntities").then(e=>({totalCount:e.length?Number(e[0].totalCount):0,limit:t,offset:a,nodes:e}))}getLegalEntitiesByIds(e){return t(this,void 0,void 0,(function*(){const{nodes:n}=yield this.getLegalEntities({where:[["id",d.TWhereAction.IN,e]],offset:0,limit:e.length});return n}))}getDriver(e){return t(this,void 0,void 0,(function*(){const n=yield this.getLegalEntitiesByIds([e]);return!!n.length&&n[0]}))}updateCustomer(e,n){return t(this,void 0,void 0,(function*(){const{knex:i,timezone:t}=this.props.context;yield i("legalEntities").update(Object.assign(Object.assign({},n),{updatedAt:l.default.tz(t).format()})).where("id",e)}))}}n.LegalEntitiesService=r,n.default=r},function(e,n,i){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=i(0),d=t(i(1)),l={legalEntities:null};n.default=function(e){if(null!==l.legalEntities)return l;const n=new d.default({context:e});return l.legalEntities=new a.DataLoader(e=>n.getLegalEntitiesByIds(e)),l}},function(e,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var i in e)n.hasOwnProperty(i)||(n[i]=e[i])}(i(4))},function(e,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),function(e){for(var i in e)n.hasOwnProperty(i)||(n[i]=e[i])}(i(5))},function(e,n,i){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n.default=e,n};Object.defineProperty(n,"__esModule",{value:!0});const d=t(i(6));n.permissions=d.default;const l=t(i(8));n.resolvers=l.default;const r=a(i(12));n.typeDefs=r;const o=t(i(1));n.service=o.default},function(e,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0});const t=i(7);n.permissions=t.shield({}),n.default=n.permissions},function(e,n){e.exports=require("graphql-shield")},function(e,n,i){"use strict";var t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const a=t(i(9)),d={Query:{legalEntities:()=>({})},Mutation:{legalEntities:()=>({})},LegalEntity:t(i(11)).default,LegalEntitiesQuery:a.default};n.default=d},function(e,n,i){"use strict";var t=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(a,d){function l(e){try{o(t.next(e))}catch(e){d(e)}}function r(e){try{o(t.throw(e))}catch(e){d(e)}}function o(e){var n;e.done?a(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,r)}o((t=t.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const d=i(0),l=a(i(2)),r=a(i(1));n.queryResolver={list:(e,n,i)=>t(void 0,void 0,void 0,(function*(){const e=d.buildQueryFilter(n),t=new r.default({context:i}),a=l.default(i);try{const n=yield t.getLegalEntities(e),i=d.buildCursorConnection(n);return n.nodes.forEach(e=>{a.legalEntities.clear(e.id).prime(e.id,e)}),i}catch(e){throw new d.ServerError("Failed to get LegalEntities list",{err:e})}}))},n.default=n.queryResolver},function(e,n){e.exports=require("moment-timezone")},function(e,n,i){"use strict";var t=this&&this.__awaiter||function(e,n,i,t){return new(i||(i=Promise))((function(a,d){function l(e){try{o(t.next(e))}catch(e){d(e)}}function r(e){try{o(t.throw(e))}catch(e){d(e)}}function o(e){var n;e.done?a(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(l,r)}o((t=t.apply(e,n||[])).next())}))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0});const d=a(i(2));n.legalEntityResolver={createdAt:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).createdAt})),updatedAt:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).updatedAt})),name:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).name})),address:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).address})),ogrn:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).ogrn})),kpp:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).kpp})),inn:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).inn})),rs:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).rs})),ks:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).ks})),bic:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).bic})),bank:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).bank})),directorNameNominative:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).directorNameNominative})),directorNameGenitive:({id:e},n,i)=>t(void 0,void 0,void 0,(function*(){const n=d.default(i);return(yield n.legalEntities.load(e)).directorNameGenitive}))},n.default=n.legalEntityResolver},function(e,n){var i={kind:"Document",definitions:[{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Query"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"legalEntities"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntitiesQuery"}}},directives:[]}]},{kind:"ObjectTypeExtension",name:{kind:"Name",value:"Mutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"legalEntities"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntitiesMutation"}}},directives:[]}]},{kind:"EnumTypeDefinition",description:{kind:"StringValue",value:"Possible data to sort of legal entities list",block:!0},name:{kind:"Name",value:"LegalEntityOrderField"},directives:[],values:[{kind:"EnumValueDefinition",name:{kind:"Name",value:"createdAt"},directives:[]},{kind:"EnumValueDefinition",name:{kind:"Name",value:"updatedAt"},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"legal entities module queries",block:!0},name:{kind:"Name",value:"LegalEntitiesQuery"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Returns legal entities list bundle",block:!0},name:{kind:"Name",value:"list"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"first"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"offset"},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"after"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"orderBy"},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntityOrderBy"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"filter"},type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntityListFilter"}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntityListConnection"}}},directives:[]}]},{kind:"ObjectTypeDefinition",name:{kind:"Name",value:"LegalEntitiesMutation"},interfaces:[],directives:[],fields:[{kind:"FieldDefinition",description:{kind:"StringValue",value:"Update legal entity",block:!0},name:{kind:"Name",value:"updateLegalEntity"},arguments:[{kind:"InputValueDefinition",name:{kind:"Name",value:"id"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"data"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InputLegalEntityData"}}},directives:[]}],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntity"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to order list of legal entities",block:!0},name:{kind:"Name",value:"LegalEntityOrderBy"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"field"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntityOrderField"}}},directives:[]},{kind:"InputValueDefinition",name:{kind:"Name",value:"direction"},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OrderDirection"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to filter list of legal entities",block:!0},name:{kind:"Name",value:"LegalEntityListFilter"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"createdAt"},type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Legal entity adge bundle",block:!0},name:{kind:"Name",value:"LegalEntityEdge"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Edge"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"node"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntity"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"cursor"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Legal entities list bundle",block:!0},name:{kind:"Name",value:"LegalEntityListConnection"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Connection"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"totalCount"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"pageInfo"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"edges"},arguments:[],type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"LegalEntityEdge"}}}},directives:[]}]},{kind:"ObjectTypeDefinition",description:{kind:"StringValue",value:"Legal entity data",block:!0},name:{kind:"Name",value:"LegalEntity"},interfaces:[{kind:"NamedType",name:{kind:"Name",value:"Node"}}],directives:[],fields:[{kind:"FieldDefinition",name:{kind:"Name",value:"id"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"createdAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"updatedAt"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DateTime"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"name"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"address"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"ogrn"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"kpp"},arguments:[],type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"inn"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"rs"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"ks"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"bic"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"bank"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"directorNameNominative"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"FieldDefinition",name:{kind:"Name",value:"directorNameGenitive"},arguments:[],type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}]},{kind:"InputObjectTypeDefinition",description:{kind:"StringValue",value:"Possible data to legal entity update",block:!0},name:{kind:"Name",value:"InputLegalEntityData"},directives:[],fields:[{kind:"InputValueDefinition",name:{kind:"Name",value:"name"},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]}]}],loc:{start:0,end:1611}};i.loc.source={body:'extend type Query {\n  legalEntities: LegalEntitiesQuery!\n}\n\nextend type Mutation {\n  legalEntities: LegalEntitiesMutation!\n}\n\n"""\nPossible data to sort of legal entities list\n"""\nenum LegalEntityOrderField {\n  createdAt\n  updatedAt\n}\n\n\n"""\nlegal entities module queries\n"""\ntype LegalEntitiesQuery {\n\n  """\n  Returns legal entities list bundle\n  """\n  list(\n    first: Int\n    offset: Int\n    after: String\n    orderBy: [LegalEntityOrderBy]\n    filter: LegalEntityListFilter\n  ): LegalEntityListConnection!\n\n}\n\ntype LegalEntitiesMutation {\n  \n  """\n  Update legal entity\n  """\n  updateLegalEntity(\n    id: ID!\n    data: InputLegalEntityData!\n  ): LegalEntity!\n}\n\n"""\nPossible data to order list of legal entities\n"""\ninput LegalEntityOrderBy {\n  field: LegalEntityOrderField!\n  direction: OrderDirection!\n}\n\n"""\nPossible data to filter list of legal entities\n"""\ninput LegalEntityListFilter {\n  createdAt: DateTime\n}\n\n"""\nLegal entity adge bundle\n"""\ntype LegalEntityEdge implements Edge {\n  node: LegalEntity!\n  cursor: String!\n}\n\n"""\nLegal entities list bundle\n"""\ntype LegalEntityListConnection implements Connection {\n  totalCount: Int!\n  pageInfo: PageInfo!\n  edges: [LegalEntityEdge]!\n}\n\n\n"""\nLegal entity data\n"""\ntype LegalEntity implements Node {\n  id: ID!\n  createdAt: DateTime!\n  updatedAt: DateTime!\n  name: String!\n  address: String!\n  ogrn: String!\n  kpp: String\n  inn: String!\n  rs: String!\n  ks: String!\n  bic: String!\n  bank: String!\n  directorNameNominative: String!\n  directorNameGenitive: String!\n}\n\n"""\nPossible data to legal entity update\n"""\ninput InputLegalEntityData {\n  name: String\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};e.exports=i}]);